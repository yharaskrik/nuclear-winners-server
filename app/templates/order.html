{% extends 'layout.html' %}
{% block body %}
    <div class="row">
        <div class="col s10">
            <form id="my_form" method="post" action="{{ url_for("place_order") }}">
                <div class="card">
                    <div>
                        <fieldset>
                            <legend>Cart</legend>
                            <table class="highlight striped">
                                <tr>
                                    <th>Name</th>
                                    <th>Weight</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                </tr>
                                {% for item in cart %}
                                    <tr>
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.price }}</td>
                                        <td>{{ item.quantity }}</td>
                                        <td>{{ item.total }}</td>
                                    </tr>
                                {% endfor %}
                                <tr>
                                    <td>{{ total_weight }}</td>
                                    <td>Total: {{ total }}</td>
                                </tr>
                            </table>
                            {% if not cart %}
                                You have nothing in your cart
                            {% endif %}
                        </fieldset>
                    </div>

                    <div>
                        <fieldset>
                            <legend>Payment Method</legend>
                            <table>
                                {% for method in payment %}
                                    <tr>
                                        <td>
                                            <input class="with-gap" type="radio" name="paymentMethod"
                                                   value="{{ method.methodID }}" id="{{ method.methodID }}p">
                                            <label for="{{ method.methodID }}p">{{ method.name }}</label>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </fieldset>
                    </div>


                    <div>
                        <fieldset>
                            <legend>Shipping Method</legend>
                            <table>

                                {% for method in shipping %}
                                    <tr>
                                        <td>
                                            <input class="with-gap" name="shippingMethod" type="radio"
                                                   id="{{ method.methodID }}s" value="{{ method.methodID }}"
                                                   onclick="updateTotals()"/>
                                            <label for="{{ method.methodID }}s">{{ method.methodName }}</label>
                                        </td>
                                        <td>
                                            {{ method.price if method.price > 0 else "Free!" }}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </fieldset>
                    </div>

                    <div>
                        <h2>Summary:</h2>
                        <table class="highlight striped" id="totals" style="border-collapse: collapse">
                            <tr>
                                <th></th>
                                <th align="right">caps</th>
                            </tr>
                            <tr>
                                <td>Subtotal:</td>
                                <td align="right">{{ total }}</td>
                            </tr>
                            <tr>
                                <td>Shipping:</td>
                                <td id="shippingTotal" align="right"></td>
                            </tr>
                            <tr style="border-top: 1px solid black">
                                <td>Tax:</td>
                                <td id="tax" align="right"></td>
                            </tr>
                            <tr style="border-top: 1px solid black">
                                <td>Total:</td>
                                <td id="total" align="right" style="font-weight: bold"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="card-action">
                        <a href="javascript:{}" onclick="document.getElementById('my_form').submit();">Place Order</a>
                    </div>
                </div>
            </form>

        </div>
    </div>
    <script>
        var tax = {{ tax }};
        var cartTotal = {{ total }}
            function updateTotals() {
                var currentShipping = document.querySelector('input[name="shippingMethod"]:checked');
                var shippingPrice = 0;
                if (currentShipping) {
                    var shippingId = currentShipping.id;
                    shippingPrice = parseInt(currentShipping.value);
                }
                document.getElementById("shippingTotal").innerHTML = shippingPrice;

                var taxprice = Math.round((cartTotal + shippingPrice) * tax);
                document.getElementById("tax").innerHTML = taxprice;
                document.getElementById("total").innerHTML = (cartTotal + shippingPrice + taxprice);
            };
        updateTotals();
    </script>
{% endblock %}