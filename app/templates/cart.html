{% extends "layout.html" %}
{% block body %}
    <div id="cartWrapper" style="width: 60%; margin: 0 auto; text-align: center;">
        <ul class="collection" style="">
            {% for item in cart %}
                <li class="collection-item avatar" style="">
                    <a href="{{ url_for('view_product', sku=item.sku) }}"><img
                            src="{{ url_for('product_picture',sku=item.sku) }}" class="circle" width="50px"></a>

                    <span class="title"><a href="{{ url_for('view_product', sku=item.sku) }}">{{ item.name }}</a></span>
                    <p>
                        {% if item.description %}
                            {{ item.description }}<br>
                        {% endif %}
                    </p>
                    <div class="row">
                        <div class="col s6 input-field">
                            <form method="get" action="{{ url_for("update_cart", pid=item.sku) }}" id="quantityBox">
                                <input id="quantityInput" min='1' type="number" name="quantity" value="{{ item.quantity }}">
                            </form>

                            <a class="waves-effect waves-light btn"
                               href="{{ url_for('delete_from_cart', pid=item.sku) }}">Remove</a>
                            <a class="waves-effect waves-light btn" id="updateButton" onclick="updateQuantity()">Update</a>
                        </div>
                    </div>

                    <span class="secondary-content">{{ item.price }} caps: {{ item.total }} Total</span>
                </li>

            {% endfor %}
        </ul>
        <div class="row">
            <div class="col s12">
                <div class="card center-align">
                    <div class="card-content">
                        Total: {{ subtotal }} caps
                    </div>
                    <div class="card-action">
                        <a href="{{ url_for("checkout") }}">Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function updateQuantity() {
                                console.log('Updating quantity()')
                                $('#quantityBox').submit();
                                $.ajax({
                                    type: 'GET',
                                    url: '/order/cart/count/',
                                    success: function (result) {
                                        $('#itemsInCart').html(result);
                                        $('#quantityInput').html(result);
                                    }
                                })
                            }
    </script>
{% endblock %}
